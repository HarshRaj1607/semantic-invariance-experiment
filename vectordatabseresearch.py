# -*- coding: utf-8 -*-
"""vectordatabseresearch.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1ZyB7RN-2BbESX1fCHpy5CiYh8rEPeHsh
"""

pip install sentence-transformers scikit-learn numpy

import numpy as np
from sentence_transformers import SentenceTransformer
from sklearn.metrics.pairwise import cosine_similarity
from sklearn.cluster import KMeans
from sklearn.metrics import adjusted_rand_score

# -----------------------------
# 1. DATASET
# -----------------------------
sentences = [
    "Football is a popular sport worldwide",
    "Basketball players are very tall",
    "Quantum physics studies subatomic particles",
    "Black holes warp spacetime",
    "Python is a programming language",
    "Machine learning improves predictions",
    "Pizza tastes delicious with cheese",
    "Pasta is a staple Italian food",
    "Stock markets fluctuate daily",
    "Investors analyze financial trends",
    "Biology studies living organisms",
    "Cells are the building blocks of life",
]

# -----------------------------
# 2. LOAD MODELS
# -----------------------------
model_A = SentenceTransformer("all-MiniLM-L6-v2")
model_B = SentenceTransformer("paraphrase-MiniLM-L12-v2")

emb_A = model_A.encode(sentences)
emb_B = model_B.encode(sentences)

# -----------------------------
# 3. NEAREST NEIGHBOR OVERLAP
# -----------------------------
def neighbor_overlap(emb1, emb2, k=3):
    sim1 = cosine_similarity(emb1)
    sim2 = cosine_similarity(emb2)

    overlaps = []

    for i in range(len(emb1)):
        # Exclude self by setting diagonal to -inf
        sim1[i, i] = -np.inf
        sim2[i, i] = -np.inf

        nn1 = np.argsort(sim1[i])[-k:]
        nn2 = np.argsort(sim2[i])[-k:]

        overlap = len(set(nn1).intersection(set(nn2))) / k
        overlaps.append(overlap)

    return np.mean(overlaps)

overlap_score = neighbor_overlap(emb_A, emb_B, k=3)
print("Average Neighbor Overlap:", overlap_score)

# -----------------------------
# 4. CLUSTER CONSISTENCY
# -----------------------------
k = 4
kmeans_A = KMeans(n_clusters=k, random_state=42).fit(emb_A)
kmeans_B = KMeans(n_clusters=k, random_state=42).fit(emb_B)

ari_score = adjusted_rand_score(kmeans_A.labels_, kmeans_B.labels_)
print("Cluster Consistency (ARI):", ari_score)

# -----------------------------
# 5. OPTIONAL ENSEMBLE TEST
# -----------------------------
ensemble_emb = (emb_A + emb_B) / 2
ensemble_overlap = neighbor_overlap(emb_A, ensemble_emb, k=3)
print("Overlap with Ensemble:", ensemble_overlap)